<%# app/views/hyrax/file_sets/media_display/_video.html.erb %>
<% content_for :body do %>
    <body data-no-turbolink="true">
<% end %>

<script>
document.addEventListener("turbolinks:load", function(event) {
  if (!event.data.timing.visitStart) {
    // Initial page load
    var script1 = document.createElement('script');
    script1.src = "https://vjs.zencdn.net/8.10.0/video.min.js";
    document.getElementsByTagName('head')[0].appendChild(script1);

    var script2 = document.createElement('script');
    script2.src = "https://unpkg.com/@silvermine/videojs-quality-selector/dist/js/silvermine-videojs-quality-selector.min.js";
    document.getElementsByTagName('head')[0].appendChild(script2);
  } else {
    // Turbolinks page load
  }
})
</script>

<div class="viewer-wrapper" data-turbolinks="false">
    <video id="video" controls class="video-js vjs-default-skin vjs-fill" style="width:100%;height:100%" preload="auto">
        <% @presenter.stored_derivatives.each do |derivative| %>
            <source src="<%= s3_url(derivative) %>" type="video/mp4" label="<%= get_derivative_res(derivative) %>" />
        <% end %>
        <%= t('hyrax.file_set.show.downloadable_content.video_tag_not_supported') %>
    </video>
    <script>
        // null out the amd configuration hash before including video.js
        define._oldAmd = define.amd
        define.amd = null
    </script>
    <script>
        videojs('video', {}, function () {
            var player = this;
            player.controlBar.addChild('QualitySelector');
        });
    </script>
    <script>
        // maybe unnecessary (?) but restore the bundle's define.amd value
        define.amd = define._oldAmd
    </script>
</div>
